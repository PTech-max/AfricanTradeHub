<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AfricanTradeHub Marketplace</title>
  <link rel="stylesheet" href="style.css">
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      background: #f5f5f5;
    }
    header {
      background: #004080;
      color: white;
      padding: 15px;
      text-align: center;
    }
    .filter-bar {
      background: #fff;
      padding: 10px;
      text-align: center;
      border-bottom: 1px solid #ddd;
    }
    .filter-bar select, .filter-bar button {
      padding: 8px;
      margin: 5px;
      border-radius: 5px;
      border: 1px solid #ccc;
    }
    .marketplace-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      gap: 20px;
      padding: 20px;
    }
    .business-card {
      background: white;
      border-radius: 10px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      padding: 15px;
      text-align: center;
      transition: transform 0.2s;
    }
    .business-card:hover {
      transform: scale(1.03);
    }
    .biz-logo {
      width: 80px;
      height: 80px;
      object-fit: cover;
      border-radius: 50%;
      margin-bottom: 10px;
    }
    .pay-btn {
      background: #004080;
      color: white;
      padding: 8px 15px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
    .pay-btn:hover {
      background: #0066cc;
    }
  </style>
</head>
<body>
  <header>
    <h1>AfricanTradeHub Marketplace</h1>
  </header>

  <!-- Country Filter -->
  <div class="filter-bar">
    <label for="countrySelect">Filter by Country:</label>
    <select id="countrySelect">
      <option value="all">All Countries</option>
      <option value="Algeria">Algeria</option>
      <option value="Angola">Angola</option>
      <option value="Benin">Benin</option>
      <option value="Botswana">Botswana</option>
      <option value="Burkina Faso">Burkina Faso</option>
      <option value="Burundi">Burundi</option>
      <option value="Cabo Verde">Cabo Verde</option>
      <option value="Cameroon">Cameroon</option>
      <option value="Central African Republic">Central African Republic</option>
      <option value="Chad">Chad</option>
      <option value="Comoros">Comoros</option>
      <option value="Congo (Brazzaville)">Congo (Brazzaville)</option>
      <option value="Congo (Kinshasa)">Congo (Kinshasa)</option>
      <option value="Djibouti">Djibouti</option>
      <option value="Egypt">Egypt</option>
      <option value="Equatorial Guinea">Equatorial Guinea</option>
      <option value="Eritrea">Eritrea</option>
      <option value="Eswatini">Eswatini</option>
      <option value="Ethiopia">Ethiopia</option>
      <option value="Gabon">Gabon</option>
      <option value="Gambia">Gambia</option>
      <option value="Ghana">Ghana</option>
      <option value="Guinea">Guinea</option>
      <option value="Guinea-Bissau">Guinea-Bissau</option>
      <option value="Ivory Coast">Ivory Coast</option>
      <option value="Kenya">Kenya</option>
      <option value="Lesotho">Lesotho</option>
      <option value="Liberia">Liberia</option>
      <option value="Libya">Libya</option>
      <option value="Madagascar">Madagascar</option>
      <option value="Malawi">Malawi</option>
      <option value="Mali">Mali</option>
      <option value="Mauritania">Mauritania</option>
      <option value="Mauritius">Mauritius</option>
      <option value="Morocco">Morocco</option>
      <option value="Mozambique">Mozambique</option>
      <option value="Namibia">Namibia</option>
      <option value="Niger">Niger</option>
      <option value="Nigeria">Nigeria</option>
      <option value="Rwanda">Rwanda</option>
      <option value="Sao Tome and Principe">Sao Tome and Principe</option>
      <option value="Senegal">Senegal</option>
      <option value="Seychelles">Seychelles</option>
      <option value="Sierra Leone">Sierra Leone</option>
      <option value="Somalia">Somalia</option>
      <option value="South Africa">South Africa</option>
      <option value="South Sudan">South Sudan</option>
      <option value="Sudan">Sudan</option>
      <option value="Tanzania">Tanzania</option>
      <option value="Togo">Togo</option>
      <option value="Tunisia">Tunisia</option>
      <option value="Uganda">Uganda</option>
      <option value="Zambia">Zambia</option>
      <option value="Zimbabwe">Zimbabwe</option>
    </select>
    <button onclick="filterByCountry()">Filter</button>
  </div>

  <!-- Marketplace Grid -->
  <main>
    <p style="text-align:center;">Only verified and paid businesses are listed below ðŸ‘‡</p>
    <div id="marketplace" class="marketplace-grid"></div>
  </main>

  <!-- JS -->
  <script>
    let allBusinesses = [];

    async function loadMarketplace() {
      try {
        const resp = await fetch("http://localhost:5000/api/marketplace");
        if (!resp.ok) throw new Error("Network error");

        const businesses = await resp.json();
        allBusinesses = businesses;
        renderBusinesses(allBusinesses);
      } catch (err) {
        console.error("Failed to load marketplace", err);
        document.getElementById("marketplace").innerHTML = "<p>Error loading businesses. Please try again later.</p>";
      }
    }

    function renderBusinesses(businesses) {
      const container = document.getElementById("marketplace");
      container.innerHTML = "";

      if (businesses.length === 0) {
        container.innerHTML = "<p>No verified businesses yet.</p>";
        return;
      }

      businesses.forEach(biz => {
        // Show only if payment is verified
        if (biz.paymentStatus !== "paid") return;

        const card = `
          <div class="business-card">
            <img src="${biz.logo}" alt="Logo" class="biz-logo">
            <h3>${biz.name}</h3>
            <p><strong>Type:</strong> ${biz.type}</p>
            <p><strong>Country:</strong> ${biz.country}</p>
            <p><strong>Reg. No:</strong> ${biz.registrationNumber}</p>
            <button class="pay-btn" onclick="viewDetails('${biz.id}')">View Details</button>
          </div>
        `;
        container.innerHTML += card;
      });
    }

    function filterByCountry() {
      const selected = document.getElementById("countrySelect").value;
      if (selected === "all") {
        renderBusinesses(allBusinesses);
      } else {
        const filtered = allBusinesses.filter(b => b.country === selected && b.paymentStatus === "paid");
        renderBusinesses(filtered);
      }
    }

    function viewDetails(bizId) {
      alert("Redirecting to details for business ID: " + bizId);
      // later you can make it redirect to /business/:id page
    }

    loadMarketplace();
  </script>
</body>
</html>
